<ion-header>
  <ion-toolbar class="bg-transparent text-neon-cyan" style="--background: transparent;">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home" color="primary" class="text-neon-cyan"></ion-back-button>
    </ion-buttons>
    <ion-title class="font-bold">Logs</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="relative">
  <div class="fixed inset-0 w-full h-full z-0 pointer-events-none">
    <img src="assets/backgroundOcellaris.jpg" class="w-full h-full object-cover" alt="Background">
    <div class="absolute inset-0 bg-gradient-to-b from-[#05161A]/70 via-[#05161A]/85 to-[#05161A]"></div>
  </div>

  <div class="relative z-10 flex flex-col min-h-full">
  <section class="px-5 pt-6 pb-4">
    <div class="flex items-start justify-between gap-4">
      <div>
        <h1 class="text-xl font-bold text-text-main">Log de registros</h1>
        <p class="text-sm text-text-muted">Mais recentes no topo.</p>
      </div>
      <button
        type="button"
        class="border border-neon-cyan text-neon-cyan rounded-xl px-4 py-2 text-sm font-semibold transition hover:bg-neon-cyan/10 disabled:opacity-60 disabled:cursor-not-allowed"
        (click)="loadLogs()"
        [disabled]="loading"
      >
        Atualizar
      </button>
    </div>
  </section>

  <p class="px-5 text-sm text-red-400" *ngIf="errorMessage">{{ errorMessage }}</p>

  <div class="px-5 pb-6" *ngIf="!loading && !logs.length && !errorMessage">
    <div class="bg-ocean-card rounded-2xl shadow-lg border border-white/5 p-6">
      <h2 class="text-base font-semibold text-text-main">Nenhum registro ainda.</h2>
      <p class="text-sm text-text-muted mt-2">Assim que uma dosagem ocorrer, ela aparece aqui.</p>
    </div>
  </div>

  <div class="px-5 pb-8 space-y-3" *ngIf="logs.length">
    <div
      *ngFor="let log of logs"
      class="bg-ocean-card rounded-2xl shadow-lg border border-white/5 p-5"
    >
      <div class="flex items-center gap-4">
        <!-- Nome da bomba (mais espaço) -->
        <div class="flex-1 min-w-0">
          <h2 class="text-base font-semibold text-text-main truncate">{{ log.bomba }}</h2>
        </div>

        <!-- Barra vertical colorida baseada no bombaId -->
        <div
          class="w-1.5 h-14 rounded-full"
          [style.background]="getPumpGradient(log.bombaId)"
        ></div>

        <!-- Ícone + Dosagem -->
        <div class="flex items-center gap-2">
          <ion-icon name="flask-outline" class="text-lg" [style.color]="getPumpColor(log.bombaId)"></ion-icon>
          <p class="text-base font-semibold" [style.color]="getPumpColor(log.bombaId)">{{ log.dosagem | number: '1.0-2' }} ml</p>
        </div>

        <!-- Horário + Origem (coluna à direita) -->
        <div class="flex flex-col items-end gap-1.5 ml-auto">
          <p class="text-xs text-text-muted">{{ log.timestamp }}</p>
          <span *ngIf="log.origem" class="px-2 py-0.5 rounded-full text-[10px] border border-ocean-light text-text-muted">
            {{ log.origem }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <div class="flex justify-center pb-10" *ngIf="loading">
    <ion-spinner name="dots" class="text-neon-cyan"></ion-spinner>
  </div>

  <ion-toast
    [isOpen]="toastOpen"
    [message]="toastMessage"
    duration="2000"
    (didDismiss)="toastOpen = false"
  ></ion-toast>
  </div>
</ion-content>

<ion-footer>
  <ion-toolbar class="bg-ocean-dark/95" style="--background: rgba(5, 22, 26, 0.95);">
    <div class="px-5 py-3">
      <button
        type="button"
        class="w-full border border-red-400 text-red-400 rounded-xl py-3 disabled:opacity-60 disabled:cursor-not-allowed"
        (click)="clearLogs()"
        [disabled]="clearing || !logs.length"
      >
        Apagar todos Logs
      </button>
    </div>
  </ion-toolbar>
</ion-footer>
